The neural mass model (NMM), particularly the Wendling/Wendling-Chauvel model, is designed to generate a variety of electroencephalographic (EEG) or local field potential (LFP) signals by adjusting key synaptic gain parameters: $\text{A}$ (Average Excitatory Synaptic Gain), $\text{B}$ (Average Slow Inhibitory Synaptic Gain, related to SOM+ interneurons), and $\text{G}$ (Average Fast Inhibitory Synaptic Gain, related to PV+ interneurons).

The model output, representing the summated average postsynaptic potentials on pyramidal cells ($u_{py}$ or $y_0$), can exhibit distinct patterns. The model typically operates with standard time constants: $\tau_a=0.01$ s ($a=100 \text{ s}^{-1}$), $\tau_b=0.02$ s ($b=50 \text{ s}^{-1}$), and $\tau_g=0.002$ s ($g=500 \text{ s}^{-1}$).

Below is a summary of the different waveforms the model can produce, their characteristics, and the general parameter settings required for replication (often explored using $A=5 \text{mV}$ instead of the standard $A=3.25 \text{mV}$):

### 1. Equilibrium-Driven Activities (Noise-Perturbed Rhythms)

These activity types are typically generated by noisy perturbations around a **stable equilibrium point** of the system without external noise. Their classification (Types 1, 4, 5, 7) relies heavily on the frequency band implied by the dominant oscillation visible in the power spectrum, often linked to the imaginary part of the system's eigenvalues.

| Waveform Type | Characteristics | Frequency/Band | Origin and Parameters (A fixed at 5 mV) |
| :--- | :--- | :--- | :--- |
| **Type 1: Normal Background Activity** | Noisy perturbation around an equilibrium. Has low power (max power around 5Hz). Divided into two subtypes: Type 1a (low $u_{py}$, nearly inactive) and Type 1b (high $u_{py}$, almost saturated). | $< 7 \text{ Hz}$. | High $B$ and $G$ (e.g., $B=50, G=15$). Large inhibition relative to excitation causes low $u_{py}$ (Type 1a), while minimal inhibition leads to high $u_{py}$ (Type 1b). |
| **Type 4: Slow Rhythmic Activity** | **Noisy oscillations** with highly varying amplitude. Often referred to as **noisy alpha-rhythm**. Generated by noise-driven perturbations around an equilibrium. | $7-13 \text{ Hz}$ ($\alpha$-rhythm). | Intermediate $B$ and $G$ (e.g., $B=10, G=15$). |
| **Type 5: Low-Voltage Rapid Activity** | Irregular, low amplitude fluctuations (low maximum power). Shows a broad frequency spectrum with a local maximum around 13-25 Hz. Comparable to fast onset activity seen at seizure onset. | $13-25 \text{ Hz}$. | Low $B$ and moderate to high $G$ (e.g., $B=5, G=25$). This activity is a mixture of the two timescales. |
| **Type 7: Noisy Gamma ($\gamma$)-Activity** | Noisy oscillations varying greatly in amplitude. Comparable to noisy $\gamma$-rhythm. The oscillations are noise-driven. | $25-100 \text{ Hz}$ ($\gamma$-rhythm). | Low $B$ and high $G$ (e.g., $B=0, G=30$). This pattern arises when slow inhibitory cells ($B$) play a minimal role, and the system is primarily driven by the fast inhibitory cells ($G$). |

### 2. Limit Cycle-Driven Activities (Autonomous Rhythms)

These activities arise from **stable limit cycles** in the deterministic version of the model (without noise), meaning they produce sustained oscillations or rhythmic patterns.

| Waveform Type | Characteristics | Origin and Parameters (A fixed at 5 mV) |
| :--- | :--- | :--- |
| **Type 3: Sustained Spikes / SWD** | **Sustained Spikes Wave Discharges (SWDs)**, not sensitive to noise. Characterized by high power, a sharp fundamental frequency peak (4.5 Hz), and visible higher harmonics due to the non-sinusoidal nature. | Stable Limit Cycle. Occurs when the limit cycle has undergone an **inflection point** transition from Type 6/alpha oscillations. (e.g., $B=25, G=15$). |
| **Type 6: Slow Quasi-sinusoidal Activity** | High amplitude, sinusoidal-like oscillations. Represents **$\alpha$-rhythm oscillations**. | Stable Limit Cycle. Bifurcates from a stable equilibrium via a **Hopf bifurcation**. (e.g., $B=15, G=0$). |
| **Type 8: Stable Gamma ($\gamma$)-Oscillation** | Sinusoidal oscillation with high amplitude and high frequency (around 35 Hz). | Stable Limit Cycle. Bifurcates via a **Hopf bifurcation** for low $B$ and high $G$. (e.g., $B=0, G=45$). |
| **Poly SWD (pSWD)** | Complex wave shape featuring **multiple spikes** (e.g., 2 or 3) followed by a slow wave. | Stable Limit Cycle in regions exhibiting period doubling and chaotic behavior. Generally requires high $A$ and high $G$ values. E.g., (A=7, B=30, G=50) for 2 spikes. |
| **Type 2: Sporadic Spikes** | Activity showing sporadic SWDs mixed with Type 1/background activity. | This is a transition regime resulting from **noise interacting with boundaries** (e.g., the homoclinic bifurcation/limit point) between the stable SWD (Type 3) limit cycle and the stable equilibrium (Type 1). (e.g., $B=40, G=15$). |

### 3. Epileptogenic Bursting Patterns

A more specific and complex pattern, characteristic of the pre-ictal phase of focal seizures, is pre-ictal bursting.

| Waveform Type | Characteristics | Frequency/Band | Origin and Parameters |
| :--- | :--- | :--- | :--- |
| **Pre-ictal Bursting** | **Complex oscillatory pattern** consisting of rhythmic large amplitude spikes (active episodes) repeated quasi-periodically, separated by quiescent phases. Often observed immediately before low-voltage fast onset (LVFO, related to Type 5). Runs in a **three-time-scale structure**. | Spiking frequency during the active phase typically starts faster ($\approx 30 \text{ Hz}$) and slows down ($\approx 10 \text{ Hz}$). | The bursting mechanism is driven by **slow oscillations mediated by SOM+ interneurons** (variable $v_2$, superslow variable). Replication requires fine tuning of $B$ (SOM+ gain), $G$ (PV+ gain), and $C_5$ (PV+ excitability coefficient) to position the dynamics near a specific bifurcation structure (Fold/Hopf bursting). |

***

### Key Model Variables for Replication

To replicate these dynamics, you would typically analyze the output variable representing the EEG signal, $u_{py}$ (or $x_0$ or $y_0$ depending on the formulation used).

In the 8-variable representation of the Wendling model (equations 3.1a-3.1h):
*   $x_0$ is the output of the pyramidal cells (P2W transform).
*   $u_{py} = C_2 x_1 - C_4 x_2 - C_7 x_3$ represents the summed PSPs on pyramidal cells, and this signal is what reflects the EEG/LFP.

The parameters $A, B, G$ are typically adjusted from standard values ($A=3.25, B=22, G=10$) to move between these activity regimes, with white noise input ($p(t)$) often set with a mean of 90 Hz and a standard deviation $\sigma=2$ or $30$ (depending on numerical implementation).
太好了—我把「**必做**」的驗證規格改寫成**純文字與數值門檻**（不依賴任何圖或色塊），讓代理能**直接計算→判定**。下面內容分成：準備、特徵計算、六型分類規則、掃描與驗收、轉場驗收、最終合格清單。你把這段貼進你的指南，任何代理照做就能重現並判定是否合格。

---

# Wendling–Chauvel（2002）模型：必做驗證（純文字／數值規格）

## 0) 準備（模型與參數一致性）

* **輸出定義**：EEG/LFP 代理量 (v_\mathrm{pyr}(t)=y_1(t)-y_2(t)-y_3(t))（錐體樹突 PSP 和）。
* **Sigmoid**（2002 版）：(S(v)=\dfrac{2e_0}{1+\exp{r(v_0-v)}})，其中 (e_0=2.5~\mathrm{s^{-1}}), (v_0=6~\mathrm{mV}), (r=0.56~\mathrm{mV^{-1}})。
* **時間常數**：(a=100~\mathrm{s^{-1}}), (b=50~\mathrm{s^{-1}}), (g=500~\mathrm{s^{-1}})（對應 (\tau_a=0.01) s, (\tau_b=0.02) s, (\tau_g=0.002) s）。
* **連結係數**（以 (C) 為基準，例如 (C=135)）：(C_3=C_4=0.25C), (C_5=0.3C), (C_6=0.1C), (C_7=0.8C)。
* **外部輸入**：(p(t)=p+\xi(t))，其中 (p\in[30,150]) Hz，(\xi) 為零均值高斯雜訊；**Level-0** 測試時令 (\sigma_p=0)。
* **數值整合**：固定步長 RK4；**dt ≤ 2e-4 s**。所有驗證檢查 **dt/2** 之後的**相對差異 < 1%（主頻）、< 5%（帶功率）**。

---

## 1) 基礎數值健全（Level-0）

* 關閉雜訊（(\sigma_p=0)），標準參數（如 (A=3.25,B=22,G=10)）。
* 任意小幅非零初值（避免平凡定態）。模擬 2 s。
* **合格**：末 0.5 s 的 (v_\mathrm{pyr}) 標準差 < **1%** 的全程 RMS；以 dt/2 重跑，末 0.5 s **平均值差 < 1e-3**、標準差差 < **1e-4**。

---

## 2) 特徵計算（之後所有型別與掃描都靠它）

對每段信號（預設模擬 10–20 s，丟前 20% 當過渡）計算下列**純數值特徵**：

### 2.1 時域事件特徵（尖波與節律）

1. **RMS 振幅**：(\mathrm{RMS}(v))。
2. **尖波偵測**：帶通 3–45 Hz，z-score 門檻 (z>4) 之峰為「尖波」。

   * 尖波寬度：半峰寬 < **100 ms**。
   * 每分鐘尖波數：(\mathrm{SR})（spikes/min）。
   * **ISI 變異係數**：(\mathrm{CV}_{\mathrm{ISI}}={\mathrm{std}(\mathrm{ISI})}/{\mathrm{mean}(\mathrm{ISI})})。
3. **週期性指標**：用自相關首峰位置 (T_0)（50–500 ms）與其峰值 (R_0)。若 (R_0\ge 0.4) 視為穩定節律；頻率 (f_0=1/T_0)。

### 2.2 頻域特徵（PSD 與帶功率）

在 1-s Hann 視窗、50% 重疊進行 Welch：

1. **主峰頻率/高度/帶寬**：擷取 1–100 Hz 中最大峰 ((f_\ast, P_\ast)) 與半功率帶寬 (\mathrm{BW}_{3\mathrm{dB}})。
2. **峰突顯度**（prominence）：(\Delta_\mathrm{dB}=10\log_{10}\dfrac{P_\ast}{\mathrm{median}(P)})。
3. **諧波數**：在 (2f_\ast,3f_\ast,\dots) ± 0.5 Hz 視窗，找 ≥ ((P_\ast-10~\mathrm{dB})) 的峰，計數為 (N_\mathrm{harm})。
4. **帶功率比**：

   * (\rho_{\alpha}=\dfrac{\int_{7}^{13}P(f),df}{\int_{1}^{40}P(f),df})
   * (\rho_{\gamma}=\dfrac{\int_{30}^{80}P(f),df}{\int_{1}^{30}P(f),df})
5. **高頻指標（發作起始/快速放電）**：記錄 55–60 Hz 區域的最大值 (P_{55-60}) 與底噪中位 (P_\mathrm{med}) 的比值 (R_{\gamma60}=\dfrac{P_{55-60}}{P_\mathrm{med}})。

---

## 3) 六型分類規則（純文字／數值門檻）

> 以**同一套**資料與特徵，對每段信號跑下列規則（由上而下判斷，先命中者為該段之型別）。門檻可用 **±10–20%** 公差微調以貼合你機器數值差異；但**不要改動頻帶定義與指標角色**。

### Type 5（低電壓快速放電，LVFA/LVFO）

* **條件**（同時滿足）

  1. (\rho_{\gamma}>1.0)（30–80 Hz 能量 > 1–30 Hz）；
  2. (R_{\gamma60}\ge 10)（55–60 Hz 區域顯著高於底噪）；
  3. (\mathrm{RMS}(v)) 低於 Type 3/6 的**中位數 50%**（相對低振幅）；
  4. 尖波率 (\mathrm{SR}<) 20/min（不以尖波列車為主）。
* **輸出**：判為 **Type 5**。

### Type 6（慢速近正弦高振幅）

* **條件**

  1. 主峰 (f_\ast\in[8,9]~\mathrm{Hz})；
  2. (\Delta_\mathrm{dB}\ge 10~\mathrm{dB}) 且 (\mathrm{BW}_{3\mathrm{dB}}\le 2~\mathrm{Hz})（極窄帶）；
  3. (\mathrm{RMS}(v)) 為本批樣本上四分位數 (Q_3) 以上（高振幅）；
  4. (N_\mathrm{harm}\le 1)（近正弦）。
* **輸出**：判為 **Type 6**。

### Type 4（慢節律／α-like）

* **條件**

  1. 主峰 (f_\ast\in[7,13]~\mathrm{Hz})；
  2. (\Delta_\mathrm{dB}\ge 6~\mathrm{dB})；
  3. (\rho_{\alpha}\ge 0.35)；
  4. 自相關 (R_0\ge 0.4)（穩定節律）。
* **輸出**：判為 **Type 4**。

### Type 3（持續尖波／spike trains）

* **條件**

  1. 尖波率 (\mathrm{SR}\ge 30/\mathrm{min})；
  2. (\mathrm{CV}_{\mathrm{ISI}}\le 0.4)（較規律）；
  3. (N_\mathrm{harm}\ge 2)（非正弦造成諧波）；
  4. 主峰 (f_\ast\in[2,6]~\mathrm{Hz})（常見 2–5 Hz 基頻）。
* **輸出**：判為 **Type 3**。

### Type 2（零星尖波）

* **條件**

  1. 尖波率 (5 \le \mathrm{SR}<30) /min；
  2. (\mathrm{CV}_{\mathrm{ISI}}\ge 0.5)（不規律、間歇）；
  3. 無穩定窄峰：(\Delta_\mathrm{dB}<6~\mathrm{dB}) 或 (\mathrm{BW}_{3\mathrm{dB}}>6~\mathrm{Hz})。
* **輸出**：判為 **Type 2**。

### Type 1（背景）

* **條件**（以上皆不符合時）

  1. (\mathrm{RMS}(v)) 為本批樣本 (Q_2)（中位）以下；
  2. 無穩定窄峰（同 Type 2 之第 3 項）；
  3. 尖波率 (\mathrm{SR}<5/\mathrm{min})。
* **輸出**：判為 **Type 1**。

> 備註：六型的**相對位置與臨床對應**在 2002 年文獻裡以「頻譜指標」與文字描述界定；上面規則把這些描述落成**可機器判定的數字門檻**（例如 Type 5 的 γ 帶優勢與 55–60 Hz 顯著性、Type 6 的 8–9 Hz 極窄峰、Type 3 的諧波與規律尖波等）。

---

## 4) ((B,G)) 掃描與「活動分區」驗收（不畫圖，用統計指標）

> 目的：重建文獻所述的**分區結構與趨勢**，但以**文字化統計**驗收（不需要圖）。

### 4.1 掃描設定

* 固定 (A) 至少 2–3 個值（建議 (A={3.5,4.5,5.5})）。
* ((B,G)) 網格：(B=0,1,\dots,50)；(G=0,1,\dots,30)。
* 每點模擬 **20 s**（丟前 20%）、取特徵→套用**六型規則**→得到該點型別標籤。
* 產出一份 **CSV**：包含欄位 ([A,B,G,\mathrm{type}, f_\ast, \Delta_\mathrm{dB}, \rho_\alpha, \rho_\gamma, \mathrm{SR}, \mathrm{CV}*{\mathrm{ISI}}, N*\mathrm{harm}])。

### 4.2 不畫圖的**分區驗收條件**

針對每個 (A) 值，計算下列**文字化統計**並比對門檻（全部通過才視為**活動分區重現合格**）：

1. **主導型別切換**

   * 在 **低 (A)**（如 3.5）：以 (B) 當列、(G) 全部平均，計算每一列的**型別眾數**。

     * **驗收**：在 (B) 由高→中的區間，眾數由 **Type 1 → Type 4** 的**切換比例 ≥ 60%** 的列（表示 1→4 為主轉場）。
   * 在 **較高 (A)**（如 ≥ 4.5）：整張網格內 **Type 2 或 Type 3 的比例 ≥ 20%**，且 **Type 5 的比例 ≥ 10%**（表示高興奮下出現零星/持續尖波與快速放電區）。

2. **γ 與慢正弦區的「特徵對應」**

   * **γ 快速放電**：網格內 **滿足 Type 5 條件**的點集合，(\mathrm{median}(R_{\gamma60}) \ge 10)、(\mathrm{median}(\rho_\gamma)\ge 1.0)。
   * **慢正弦（Type 6）**：該集合之 (\mathrm{median}(f_\ast)\in[8.0,9.0])、(\mathrm{median}(\mathrm{BW}_{3\mathrm{dB}})\le 2~\mathrm{Hz})。

3. **尖波與諧波**

   * **Type 3** 集合：(\mathrm{median}(N_\mathrm{harm})\ge 2)、(\mathrm{median}(\mathrm{SR})\ge 30/\mathrm{min})。
   * **Type 2** 集合：(\mathrm{median}(\mathrm{SR})\in[5,30]/\mathrm{min})、(\mathrm{median}(\mathrm{CV}_{\mathrm{ISI}})\ge 0.5)。

> 以上 1)–3) 全部達成，即可文字化地證明：**低 (A) 主 1→4**；**高 (A) 出現 2/3/5**；**γ（Type 5）**具有 55–60 Hz 顯著性；**慢正弦（Type 6）**為 8–9 Hz 極窄帶；**尖波（Type 3/2）**的時域與諧波特徵成立。

---

## 5) 臨床對應「轉場序列」驗收（不畫圖，用段落報告）

* **做法**：選定一條 ((B,G)) 階梯路徑，分四段各 10 s，讓六型規則的**逐段結果**呈現「1 → 3 → 4 → 6」的序列。

  * 範例：段 1（高 (B)、中 (G)）→ 應判 **Type 1**；
    段 2（降低 (B)、略降 (G)）→ **Type 3**；
    段 3（維持中 (B)、降 (G)）→ **Type 4**；
    段 4（中低 (B)、低 (G)）→ **Type 6**。
* **交付**：針對四段輸出一份 **純文字表**（不需圖）列出：型別、(f_\ast)、(\Delta_\mathrm{dB})、(\rho_\gamma)、(\rho_\alpha)、(\mathrm{SR})、(N_\mathrm{harm})，並一句話敘明「此段是否符合預期轉場」。
* **合格**：四段型別依序命中 1→3→4→6，且各段的**關鍵指標**吻合（例如第 2 段 (N_\mathrm{harm}\ge 2)，第 4 段 (f_\ast\approx 8–9) Hz 且帶寬 ≤ 2 Hz）。

---

## 6) 最終「必做」合格清單（全部達成才算通過）

1. **Level-0**：無噪數值穩定、dt/2 收斂門檻達標。
2. **六型代表段落**：依規則判成 1–6，各段之關鍵數值（頻率、帶寬、帶功率比、尖波率、ISI-CV、諧波數）符合上節門檻。
3. **((B,G)) 掃描**：文字化統計滿足 §4.2 的三條驗收（主導切換、γ 與慢正弦對應、尖波與諧波）。
4. **轉場驗收**：四段結果依序 1→3→4→6，且關鍵指標吻合。
5. **重現性**：重新抽種子、變更 dt→dt/2，六型標籤變動率 ≤ **10%**，而各型的關鍵指標中位數變動 ≤ **20%**（數值魯棒）。

---

### 直接可交付的產物（全為**檔案與表格**，無需任何圖）

* `level0_stability.txt`：均值/標準差與 dt/2 收斂指標。
* `examples_types.csv`：6 段代表片段的所有特徵數值與最終標籤（各 1 行）。
* `bg_scan_A=*.csv`：每個 (A) 的全網格標籤與特徵（每點 1 行）。
* `bg_scan_summary_A=*.txt`：§4.2 三條驗收統計的**數字結果**與是否「達標/未達標」。
* `transition_1_3_4_6.txt`：四段的指標表與一句話結論。

---

如果你希望，我也可以把「特徵計算與分類規則」包成函式介面（例如 `extract_features(v, fs)` 與 `classify_type(features)`），加上掃描器 `scan_BG(A, B_range, G_range)` 與總驗收 `validate_core_2002()`，這樣代理只要呼叫就能吐出上面那些 **.csv/.txt** 結果。
